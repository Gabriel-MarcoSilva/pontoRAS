"use strict";(self["webpackChunkproject"]=self["webpackChunkproject"]||[]).push([[774],{1774:function(t,e,s){s.r(e),s.d(e,{default:function(){return D}});var i=s(641),a=s(33),o=s(3751);const r={class:"container"},n={style:{display:"flex",width:"100%","justify-content":"space-between",cursor:"pointer"}},d={id:"timer"},h={id:"container-timer",class:"box"},l={id:"tempo"},u={class:"container-button"},c={id:"container-history",class:"box"},m={key:0},p={key:1,style:{width:"100%"}},g={style:{display:"grid","grid-template-columns":"repeat(3, 33%)",gap:"1%",width:"100%"}},b={key:0,id:"afazeres"},f={class:"container-button"};function k(t,e,s,k,v,C){const y=(0,i.g2)("Alert");return(0,i.uX)(),(0,i.CE)("section",r,[(0,i.Lk)("div",n,[(0,i.Lk)("a",{onClick:e[0]||(e[0]=t=>C.loading())},"üîÑ"),(0,i.Lk)("a",{onClick:e[1]||(e[1]=t=>C.logout())},"Sair")]),e[12]||(e[12]=(0,i.Lk)("h1",null,"Ponto RAS",-1)),(0,i.Lk)("div",d,[(0,i.Lk)("div",h,[(0,i.Lk)("div",l,(0,a.v_)(v.tempo),1),(0,i.Lk)("div",u,[(0,i.Lk)("button",{onClick:e[2]||(e[2]=t=>C.finishTimer()),onDisabled:e[3]||(e[3]=(...t)=>v.disabledButton&&v.disabledButton(...t)),id:"btnParar"},"Finalizar expediente",32)])]),(0,i.Lk)("div",c,[this.historicoUser.data?.error?((0,i.uX)(),(0,i.CE)("div",m,(0,a.v_)(this.historicoUser.data.error),1)):((0,i.uX)(),(0,i.CE)("div",p,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(v.historicoUser.data,(t=>((0,i.uX)(),(0,i.CE)("div",{class:"history-item",key:t},[(0,i.Lk)("div",g,[(0,i.Lk)("p",null," Data: "+(0,a.v_)(t.data),1),(0,i.Lk)("p",null," Tempo: "+(0,a.v_)(t.horas),1),(0,i.Lk)("p",null," Hor√°rio: "+(0,a.v_)(t.horario),1)]),e[10]||(e[10]=(0,i.Lk)("br",null,null,-1)),(0,i.eW)(" Descri√ß√£o: "+(0,a.v_)(t.descricao),1)])))),128))]))])]),v.isOpenPopUp?((0,i.uX)(),(0,i.CE)("div",b,[(0,i.Lk)("form",{method:"get",onSubmit:e[8]||(e[8]=(0,o.D$)((t=>C.marcarHorario()),["prevent"])),id:"formHorario"},[e[11]||(e[11]=(0,i.Lk)("p",null,"O que voc√™ fez durante seuexpediente?",-1)),(0,i.bo)((0,i.Lk)("textarea",{onKeyup:e[4]||(e[4]=t=>C.habilityButton()),"onUpdate:modelValue":e[5]||(e[5]=t=>v.descricao=t),name:"afazer",id:"afazer",rows:"6",cols:"30"},null,544),[[o.Jo,v.descricao]]),(0,i.Lk)("div",f,[(0,i.Lk)("button",{type:"submit",id:"btnMarcarHorario",onDisabled:e[6]||(e[6]=(...t)=>v.disabledButtonHorario&&v.disabledButtonHorario(...t))},"enviar",32),(0,i.Lk)("button",{onClick:e[7]||(e[7]=t=>C.fecharPopUp()),type:"button"},"cancelar")])],32)])):(0,i.Q3)("",!0),((0,i.uX)(),(0,i.Wv)(y,{message:v.message,size:v.size,onClose:e[9]||(e[9]=t=>this.message=""),key:v.message},null,8,["message","size"]))])}s(4114);var v=s(5948),C=s(9031),y=s(9753),L={name:"ComponentDashboard",components:{Alert:y.A},emits:["closeMenu","openMenu"],data(){return{nome:"",isAdmin:!1,rodando:!1,dataUser:[],usuarioID:"",tempo:"00:00:00",segundos:0,intervalo:0,tempoNaC11:0,auxTempoC11:"",local:"",deltaLatitude:0,deltaLongitude:0,isOpen:!1,widthScreen:0,dataControle:new Date,isEditMembresia:!1,message:"",size:0,descricao:"",membresia:"",isOpenPopUp:!1,historicoUser:[],disabledButton:!1,disabledButtonHorario:!1}},async mounted(){this.dados=await(0,v.o)(),this.usuarioID=this.dados.uid,this.nome=this.dados.nome,this.$emit("openMenu"),this.loading()},methods:{async loading(){const t=localStorage.getItem("token"),e=localStorage.getItem("dataInit"),s=new Date;t&&s.toLocaleDateString().split("/")[0]===e.split("/")[0]&&(this.initTimer(),await this.getDate()),this.dataUser=await(0,C.Cl)(this.usuarioID),this.isAdmin="admin"===this.dataUser[0].role},async loading2(){try{await this.obterLocalizacao();const t=localStorage.getItem("token"),e=.01;this.local=this.deltaLatitude<e&&this.deltaLongitude<e,this.local?(this.disableButton(!1),localStorage.getItem("timeInit")||localStorage.setItem("timeInit",(this.dataControle.getHours()<10?"0"+this.dataControle.getHours():this.dataControle.getHours())+":"+(this.dataControle.getMinutes()<10?"0"+this.dataControle.getMinutes():this.dataControle.getMinutes())+":"+(this.dataControle.getSeconds()<10?"0"+this.dataControle.getSeconds():this.dataControle.getSeconds())),t&&(this.initTimer(),await this.getDate())):(await this.getDate(),this.disableButton(!0),this.atualizarDisplay())}catch(t){return null}},logout(){const t=!(this.segundos>0)||confirm("Deseja sair mesmo? Se sair agora seu progresso ser√° perdido");t&&(this.$router.push("/"),localStorage.clear(),this.$emit("closeMenu"))},formatarTempo(t){let e=Math.floor(t/3600),s=Math.floor(t%3600/60),i=t%60;return String(e).padStart(2,"0")+":"+String(s).padStart(2,"0")+":"+String(i).padStart(2,"0")},atualizarDisplay(){this.tempo=this.formatarTempo(this.segundos),this.dias=Math.floor(this.tempoNaC11/86400),this.auxTempoC11=(this.dias>0?this.dias.toString()+"d ":"")+this.formatarTempo(this.tempoNaC11-86400*this.dias)},async getDate(){if(this.historicoUser=await(0,C.HA)(this.usuarioID),this.historicoUser.status)for(let t=0;t<this.historicoUser.data.length;t++)this.tempoNaC11+=this.historicoUser.data[t].horas,this.historicoUser.data[t].data=await this.dateVisual(this.historicoUser.data[t].data),this.historicoUser.data[t].horas=await this.formatarTempo(this.historicoUser.data[t].horas);else this.historicoUser.data?.error?(this.message="N√£o h√° registros",this.size=60):(this.message="N√£o foi poss√≠vel ver seu hist√≥rico",this.size=60)},dateVisual(t){const e=t.split("T")[0],s=e.split("-")[2],i=e.split("-")[1],a=e.split("-")[0];return s+"/"+i+"/"+a},formatDate(t){const e=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${s}-${i}`},async initTimer(){const t=localStorage.getItem("timeInit"),e=Number(t.split(":")[0]),s=Number(t.split(":")[1]),i=Number(t.split(":")[2]),a=new Date,o=a.getHours()-e,r=a.getMinutes()-s,n=a.getSeconds()-i;this.segundos=3600*o+60*r+n,this.tempoNaC11=this.segundos,this.rodando||(this.rodando=!0,this.intervalo=setInterval((()=>{this.segundos++,this.tempoNaC11++,this.atualizarDisplay()}),1e3))},async marcarHorario(){const t=new Date,e=localStorage.getItem("dataInit"),s={horas:this.segundos>=36e3?36e3:this.segundos,horario:t.toLocaleTimeString(),descricao:this.descricao,usuarioId:this.usuarioID},i=Number(t.toLocaleTimeString().split(":")[0]);if(i>21)this.message="Horario fora do expediente",this.size=20,this.segundos=0,this.rodando=!1;else if(t.toLocaleDateString().split("/")[0]!==e.split("/")[0])this.message="Hor√°rio n√£o cadastrado, Dr. Who",this.size=20,this.segundos=0,this.rodando=!1;else{const t=await(0,C.hx)(s);t?(localStorage.setItem("timeInit",s.horario),this.disableButton(!0),this.message="Registrado com sucesso!",this.size=30,this.fecharPopUp(),this.resetar(),this.descricao="",this.loading()):(this.message="Coloque uma descri√ß√£o",this.size=30)}},disableButton(t){this.disabled=t},finishTimer(){this.segundos>180?this.isOpenPopUp=!0:(this.message="Hor√°rio n√£o cadastrado. Voc√™ ficou pouco tempo na C11",this.size=60)},fecharPopUp(){this.isOpenPopUp=!1,this.descricao=""},resetar(){clearInterval(this.intervalo),this.segundos=0,this.rodando=!1,this.atualizarDisplay()},habilityButton(){this.disabledButtonHorario=""===this.descricao},async obterLocalizacao(){return new Promise(((t,e)=>{"geolocation"in navigator?navigator.geolocation.getCurrentPosition((function(e){const s=e.coords.latitude,i=e.coords.longitude;this.deltaLatitude=Math.abs(Math.abs(s)-12.656981),this.deltaLongitude=Math.abs(Math.abs(i)-39.094652),t()}),(function(t){this.message="Erro ao obter localiza√ß√£o",this.size=30,e(t)})):(this.message="Geolocaliza√ß√£o n√£o √© suportada neste navegador.",this.size=40,e(new Error("Geolocaliza√ß√£o n√£o suportada")))}))},openFormMembreship(){confirm("Voc√™ possui membresia?")&&(this.isEditMembresia=!0,this.membresia=this.dataUser.membresia.split("/")[0])},closeFormMembreship(){document.getElementById("formMembreship").style.display="none"},async upMembreship(){const t={id:this.usuarioID,membresia:this.membresia+"/ON"},e=await(0,C.LO)(t);e.status?(this.dataUser.membresia=t.membresia,this.isEditMembresia=!1,this.message="Membresia atualizada com sucesso!",this.size=30):(this.message="N√£o foi poss√≠vel atualizar sua membresia",this.size=35)},goToAdmin(){this.$router.push("/dashboard-admin")},newCad(){this.$router.back()}}},S=s(6262);const z=(0,S.A)(L,[["render",k],["__scopeId","data-v-7c019710"]]);var D=z}}]);
//# sourceMappingURL=774.78a6eaad.js.map